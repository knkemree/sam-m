{% extends 'base.html' %}
{% load static %}
{% block title %}Custom T-Shirts{% endblock %}

{% block blank %}
<link href="{% static 'css/tee.css' %}" rel="stylesheet">


<!--=============================================
	=            breadcrumb area         =
	=============================================-->
	
	<div class="breadcrumb-area pt-15 pb-15">
		<div class="container">
			<div class="row">
				<div class="col-lg-12">
					<!--=======  breadcrumb container  =======-->
					
					<div class="breadcrumb-container">
						<nav>
							<ul>
								<li class="parent-page"><a href="index.html">Home</a></li>
								<li><a href="{% url 'tee' %}">Tee</a></li>
							</ul>
						</nav>
					</div>
					
					<!--=======  End of breadcrumb container  =======-->
				</div>
			</div>
		</div>
	</div>
	
	<!--=====  End of breadcrumb area  ======-->
	
	<!--=============================================
    =            beginning of message         =
    =============================================-->

    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                {% if messages %}
				{% for message in messages %}
				<div class="alert alert-{{message.tags}}" role="alert">
					{{message}}
				</div>
				{% endfor %}
                {% endif %}
            </div>
        </div>
    </div>

    <!--=====  End of message  ======-->
    
    <!--=============================================
    =            My Account page content         =
    =============================================-->

    <div class="page-section mb-50">
		<div class="container">
			<div class="row">
				<div class="col-12">
					<div class="row">
						
                    
                
                
                        <div class="col-lg-12 col-12">
                            <h2>SAM&M Stepping Up on T-Shirt Printing Business!</h2>
                            <br>
                            <!-- Create the container of the tool -->
                            <div id="tshirt-div">
                                <!-- 
                                    Initially, the image will have the background tshirt that has transparency
                                    So we can simply update the color with CSS or JavaScript dinamically
                                -->
                                <img id="tshirt-backgroundpicture" src="{% static 'img/background_tshirt.png' %}"/>

                                <!-- 
                                    The container where Fabric.js will work. Notice that in the the style of #canvas
                                    the width and height need to match with the attributes
                                -->
                                <div id="drawingArea" class="drawing-area">					
                                    <div class="canvas-container">
                                        <canvas id="tshirt-canvas" width="200" height="400"></canvas>
                                       
                                    </div>
                                </div>
                            </div>
                            <p>To remove a loaded picture on the T-Shirt select it and press the <kbd>DEL</kbd> key.</p>
                            <!-- The select that will allow the user to pick one of the static designs -->
                            <br>
                            <label for="tshirt-design">T-Shirt Design:</label>
                            <select id="tshirt-design">
                                <option value="">Select one of our designs ...</option>
                                <option value="https://ourcodeworld.com/public-media/gallery/gallery-5d5b0e95d294c.png">Batman</option>
                            </select>

                            <!-- The Select that allows the user to change the color of the T-Shirt -->
                            <br><br>
                            <label for="tshirt-color">T-Shirt Color:</label>
                            <select id="tshirt-color">
                                <!-- You can add any color with a new option and definings its hex code -->
                                <option value="#fff">White</option>
                                <option value="#000">Black</option>
                                <option value="#f00">Red</option>
                                <option value="#008000">Green</option>
                                <option value="#ff0">Yellow</option>
                            </select>

                            <br><br>
                            <label for="tshirt-custompicture">Upload your own design:</label>
                            <input type="file" id="tshirt-custompicture" />
                            <br>
                            <input id='save' type="button" value="Save as image"/>
                            
                            
                            <!-- Include Fabric.js in the page -->
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.1.0/fabric.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
                            <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.0/FileSaver.min.js"></script>

                            <script>
                                let canvas = new fabric.Canvas('tshirt-canvas');

                                

                                var iTextSample = new fabric.IText('hello\nworld', {
                                left: 50,
                                top: 50,
                                fontFamily: 'Helvetica',
                                fill: '#333',
                                lineHeight: 1.1,
                                styles: {
                                    0: {
                                    0: { textDecoration: 'underline', fontSize: 80 },
                                    1: { textBackgroundColor: 'red' }
                                    },
                                    1: {
                                    0: { textBackgroundColor: 'rgba(0,255,0,0.5)' },
                                    4: { fontSize: 20 }
                                    }
                                }
                                });

                                canvas.add(iTextSample);

                                function addHandler(id, fn, eventName) {
  document.getElementById(id)[eventName || 'onclick'] = function() {
    var el = this;
    if (obj = canvas.getActiveObject()) {
      fn.call(el, obj);
      canvas.renderAll();
    }
  };
}

function setStyle(object, styleName, value) {
  if (object.setSelectionStyles && object.isEditing) {
    var style = { };
    style[styleName] = value;
    object.setSelectionStyles(style);
  }
  else {
    object[styleName] = value;
  }
}

function getStyle(object, styleName) {
  return (object.getSelectionStyles && object.isEditing)
    ? object.getSelectionStyles()[styleName]
    : object[styleName];
}


addHandler('underline', function(obj) {
  var isUnderline = (getStyle(obj, 'textDecoration') || '').indexOf('underline') > -1;
  setStyle(obj, 'textDecoration', isUnderline ? '' : 'underline');
});
                                

                                // canvas.add(new fabric.IText('Text', { 
                                // fontFamily: 'arial black',
                                // left: 50, 
                                // top: 150 ,
                                
                                // }));

                                function updateTshirtImage(imageURL){
                                    fabric.Image.fromURL(imageURL, function(img) {                   
                                        img.scaleToHeight(100);
                                        img.scaleToWidth(100); 
                                        canvas.centerObject(img);
                                        canvas.add(img);
                                        canvas.renderAll();
                                    });
                                }
                                
                                
                                document.getElementById("tshirt-color").addEventListener("change", function(){
                                    document.getElementById("tshirt-div").style.backgroundColor = this.value;
                                }, false);
                               
                                document.getElementById("tshirt-design").addEventListener("change", function(){
                                    updateTshirtImage(this.value);
                                    console.log(this.value);
                                }, false);
                                // When the user clicks on upload a custom picture
                                document.getElementById('tshirt-custompicture').addEventListener("change", function(e){
                                    var reader = new FileReader();
                                    
                                    reader.onload = function (event){
                                        var imgObj = new Image();
                                        imgObj.src = event.target.result;

                                        // When the picture loads, create the image in Fabric.js
                                        imgObj.onload = function () {
                                            var img = new fabric.Image(imgObj);

                                            img.scaleToHeight(300);
                                            img.scaleToWidth(300); 
                                            canvas.centerObject(img);
                                            canvas.add(img);
                                            canvas.renderAll();
                                        };
                                    };

                                    // If the user selected a picture, load it
                                    if(e.target.files[0]){
                                        reader.readAsDataURL(e.target.files[0]);
                                    }
                                }, false);

                                // When the user selects a picture that has been added and press the DEL key
                                // The object will be removed !
                                document.addEventListener("keydown", function(e) {
                                    var keyCode = e.keyCode;

                                    if(keyCode == 46){
                                        console.log("Removing selected element on Fabric.js on DELETE key !");
                                        canvas.remove(canvas.getActiveObject());
                                    }
                                }, false);

                               
                                
                                
                            </script>
                            
                            
                            
                            <!-- <script>
                                domtoimage.toBlob(document.getElementById('tshirt-div'))
                                    .then(function (blob) {
                                        window.saveAs(blob, 'my-node.png');
                                    });
                            </script> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

       
{% endblock %}